# UI 預覽 - Qt 多平台行事曆整合工具

## 主視窗佈局

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 檔案(F)  說明(H)                                    Qt 多平台行事曆整合工具      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌──────────────────┬───────────────────────────────────┬───────────────────┐  │
│  │   帳號認證       │     搜尋與篩選                    │   事件詳情        │  │
│  │                  │                                   │                   │  │
│  │ ┌──────────────┐ │  ┌────────────────────────────┐  │                   │  │
│  │ │ 連接 Google  │ │  │ 搜尋: [____________]       │  │                   │  │
│  │ │  Calendar    │ │  └────────────────────────────┘  │                   │  │
│  │ └──────────────┘ │                                   │                   │  │
│  │                  │  開始日期: [2024-12-14]          │                   │  │
│  │ ┌──────────────┐ │  結束日期: [2025-01-13]          │  選擇事件以       │  │
│  │ │ 連接 Outlook │ │                                   │  查看詳情         │  │
│  │ └──────────────┘ │  平台: [全部 ▼] [獲取事件]       │                   │  │
│  │                  │                                   │                   │  │
│  │   行事曆         │  ────────────────────────────────  │                   │  │
│  │                  │                                   │                   │  │
│  │  □ Google        │     事件列表                      │                   │  │
│  │    Calendar      │                                   │                   │  │
│  │                  │  ┌────────────────────────────┐  │                   │  │
│  │  □ Microsoft     │  │ 2024-12-15 10:00 - 團隊會議│  │                   │  │
│  │    Outlook       │  ├────────────────────────────┤  │                   │  │
│  │                  │  │ 2024-12-16 14:00 - 專案討論│  │                   │  │
│  │                  │  ├────────────────────────────┤  │                   │  │
│  │                  │  │ 2024-12-17 全天 - 公司旅遊 │  │                   │  │
│  │                  │  ├────────────────────────────┤  │                   │  │
│  │                  │  │ 2024-12-18 09:00 - 客戶拜訪│  │                   │  │
│  │                  │  └────────────────────────────┘  │                   │  │
│  │                  │                                   │                   │  │
│  └──────────────────┴───────────────────────────────────┴───────────────────┘  │
│                                                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 就緒                                                                            │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 功能區域說明

### 1. 左側面板（帳號認證與行事曆列表）

**帳號認證區**
- **連接 Google Calendar** 按鈕
  - 點選後開啟瀏覽器進行 OAuth 2.0 認證
  - 認證成功後按鈕變為綠色「✓ Google Calendar 已連接」
  - 按鈕會被停用，防止重複認證

- **連接 Microsoft Outlook** 按鈕
  - 點選後開啟瀏覽器進行 Azure AD OAuth 認證
  - 認證成功後按鈕變為藍色「✓ Outlook 已連接」
  - 按鈕會被停用

**行事曆列表區**
- 顯示已連接的行事曆平台
- 樹狀結構顯示
- 可展開查看子行事曆（未來功能）

### 2. 中間面板（搜尋、篩選與事件列表）

**搜尋與篩選區**
- **搜尋框**
  - 即時搜尋事件標題、描述、地點
  - 輸入時立即過濾事件列表

- **日期範圍選擇**
  - 開始日期：選擇查詢起始日期
  - 結束日期：選擇查詢結束日期
  - 可使用日曆彈窗選擇

- **平台篩選器**
  - 下拉選單：全部 / Google / Outlook
  - 切換顯示不同平台的事件

- **獲取事件按鈕**
  - 未認證時停用（灰色）
  - 認證後啟用
  - 點選後從選定的平台獲取事件

**事件列表區**
- 列表顯示所有獲取的事件
- Google 事件以藍色文字顯示
- Outlook 事件以深藍色文字顯示
- 格式：日期時間 - 事件標題
- 點選事件可在右側查看詳情

### 3. 右側面板（事件詳情）

顯示選中事件的完整資訊：
- **標題**：事件名稱（大標題）
- **平台**：來源平台（Google Calendar / Microsoft Outlook）
- **開始時間**：完整的日期和時間
- **結束時間**：完整的日期和時間
- **全天事件**：是 / 否
- **地點**：事件地點（如有）
- **描述**：事件詳細描述（如有）
- **參與者**：參與者電子郵件列表（如有）

### 4. 狀態列

顯示程式目前狀態：
- 「就緒」：待命狀態
- 「正在連接 Google Calendar...」：認證進行中
- 「Google Calendar 認證成功」：認證完成
- 「正在獲取事件...」：資料獲取中
- 「已獲取 X 個事件」：獲取完成
- 錯誤訊息（如有）

## UI 特色

### 顏色區分
- **Google Calendar 事件**：藍色 (#4285F4)
- **Microsoft Outlook 事件**：深藍色 (#0078D4)
- **已連接按鈕**：綠色（Google）/ 藍色（Outlook）

### 互動回饋
- 按鈕 hover 效果
- 選中事件高亮顯示
- 即時搜尋過濾
- 狀態列訊息更新

### 使用者友善
- 清晰的分區佈局
- 直覺的操作流程
- 視覺化的連接狀態
- 完整的錯誤提示

## 認證流程示意

### Google Calendar 認證流程

```
1. 使用者點選「連接 Google Calendar」
   ↓
2. 程式啟動本地 HTTP 伺服器（埠 8080）
   ↓
3. 程式開啟預設瀏覽器，導向 Google 授權頁面
   ↓
4. 使用者在瀏覽器中登入 Google 帳號
   ↓
5. Google 顯示權限請求（讀取行事曆、讀取任務）
   ↓
6. 使用者點選「允許」
   ↓
7. Google 重定向到 http://localhost:8080
   ↓
8. 本地伺服器接收授權碼
   ↓
9. 程式用授權碼交換 Access Token
   ↓
10. 按鈕變為綠色「✓ Google Calendar 已連接」
   ↓
11. 「獲取事件」按鈕啟用
```

### Microsoft Outlook 認證流程

```
1. 使用者點選「連接 Microsoft Outlook」
   ↓
2. 程式啟動本地 HTTP 伺服器（埠 8081）
   ↓
3. 程式開啟預設瀏覽器，導向 Microsoft 授權頁面
   ↓
4. 使用者在瀏覽器中登入 Microsoft 帳號
   ↓
5. Microsoft 顯示權限請求（讀取行事曆、讀取任務、讀取使用者資訊）
   ↓
6. 使用者點選「接受」
   ↓
7. Microsoft 重定向到 http://localhost:8081
   ↓
8. 本地伺服器接收授權碼
   ↓
9. 程式用授權碼交換 Access Token
   ↓
10. 按鈕變為藍色「✓ Outlook 已連接」
   ↓
11. 「獲取事件」按鈕啟用
```

## 使用情境範例

### 情境 1：單一平台使用

```
使用者 → 連接 Google Calendar
      → 認證成功
      → 設定日期範圍（今天至 30 天後）
      → 點選「獲取事件」
      → 查看事件列表（全部為藍色 Google 事件）
      → 點選事件查看詳情
      → 使用搜尋框尋找特定事件
```

### 情境 2：多平台整合

```
使用者 → 連接 Google Calendar
      → 認證成功
      → 連接 Microsoft Outlook
      → 認證成功
      → 點選「獲取事件」
      → 查看混合事件列表（藍色 + 深藍色）
      → 使用平台篩選器切換顯示
        - 選擇「Google」：只顯示 Google 事件
        - 選擇「Outlook」：只顯示 Outlook 事件
        - 選擇「全部」：顯示所有事件
      → 使用搜尋功能尋找跨平台事件
```

### 情境 3：日常工作流程

```
早上：
  → 開啟程式
  → 查看今日行程（已從快取載入）
  → 點選「獲取事件」更新最新資料

工作中：
  → 搜尋「會議」查看所有會議事件
  → 點選事件查看會議室位置
  → 查看參與者名單

下班前：
  → 查看明天的行程
  → 確認重要事件的時間和地點
```

## 技術架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                        UI Layer                             │
│                     (MainWindow)                            │
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ Account Mgmt │  │  Event List  │  │Event Details │    │
│  │   Widgets    │  │   Widget     │  │   Widget     │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────────────────────────┘
                          ↓ ↑
┌─────────────────────────────────────────────────────────────┐
│                   Business Logic Layer                      │
│                    (CalendarManager)                        │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Event Aggregation & Sync                │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
           ↓ ↑                              ↓ ↑
┌────────────────────────┐      ┌────────────────────────┐
│  Google Calendar       │      │  Microsoft Outlook     │
│  Adapter               │      │  Adapter               │
│                        │      │                        │
│  • OAuth 2.0           │      │  • OAuth 2.0 (Azure)   │
│  • Calendar API        │      │  • Graph API           │
│  • Tasks API           │      │  • Calendar View       │
└────────────────────────┘      └────────────────────────┘
           ↓ ↑                              ↓ ↑
┌─────────────────────────────────────────────────────────────┐
│                   Storage Layer                             │
│                  (DatabaseManager)                          │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              SQLite Database                         │  │
│  │  • Events Table                                      │  │
│  │  • Calendars Table                                   │  │
│  │  • Tasks Table                                       │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 資料流程

### 獲取事件流程

```
MainWindow::onFetchEventsClicked()
    ↓
CalendarManager::fetchAllEvents(start, end)
    ↓
┌──────────────────────────────────┐
│ 並行呼叫所有已連接的適配器      │
├──────────────────────────────────┤
│ GoogleAdapter::fetchEvents()     │
│ OutlookAdapter::fetchEvents()    │
└──────────────────────────────────┘
    ↓
各適配器發送 HTTP 請求至對應的 API
    ↓
解析 JSON 回應，轉換為 CalendarEvent 物件
    ↓
emit eventsReceived(events)
    ↓
CalendarManager 彙總所有事件
    ↓
emit eventsUpdated(allEvents)
    ↓
MainWindow::onEventsUpdated(events)
    ↓
更新 UI 事件列表 + 儲存到資料庫
```

## 效能特性

- **非同步操作**：所有網路請求都是非同步的，不會凍結 UI
- **快取機制**：事件儲存在本地 SQLite 資料庫
- **即時搜尋**：搜尋過濾在記憶體中進行，無需重新查詢
- **批次處理**：同時從多個平台獲取事件

## 未來擴展功能

預留的 UI 空間和架構可支援：
- ✅ 新增/編輯/刪除事件
- ✅ 設定提醒
- ✅ 行事曆顏色自訂
- ✅ 更多平台整合（Apple Calendar）
- ✅ 匯出功能（iCal 格式）
- ✅ 離線模式
- ✅ 同步狀態指示器

---

**版本**: 1.0.0
**最後更新**: 2024 年 12 月
